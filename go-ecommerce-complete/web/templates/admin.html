<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†åå° - ç”µå•†å¹³å°</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container navbar-content">
            <a href="/" class="navbar-brand">ğŸ›’ ç”µå•†å¹³å°</a>
            <div class="navbar-user"></div>
        </div>
    </nav>

    <div class="container" style="margin-top: 30px; margin-bottom: 60px;">
        <h2 style="margin-bottom: 30px;">ç®¡ç†åå°</h2>
        
        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
            <button class="btn btn-primary" onclick="showTab('stats')">æ•°æ®ç»Ÿè®¡</button>
            <button class="btn btn-outline" onclick="showTab('products')">å•†å“ç®¡ç†</button>
            <button class="btn btn-outline" onclick="showTab('users')">ç”¨æˆ·ç®¡ç†</button>
        </div>

        <!-- ç»Ÿè®¡æ•°æ® -->
        <div id="statsTab">
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px;">
                <div class="card">
                    <div class="card-body text-center">
                        <div style="font-size: 32px; color: var(--primary-color); font-weight: bold;" id="totalUsers">0</div>
                        <div style="margin-top: 10px; color: #666;">æ€»ç”¨æˆ·æ•°</div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body text-center">
                        <div style="font-size: 32px; color: var(--secondary-color); font-weight: bold;" id="totalProducts">0</div>
                        <div style="margin-top: 10px; color: #666;">å•†å“æ€»æ•°</div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body text-center">
                        <div style="font-size: 32px; color: var(--success-color); font-weight: bold;" id="totalOrders">0</div>
                        <div style="margin-top: 10px; color: #666;">è®¢å•æ€»æ•°</div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body text-center">
                        <div style="font-size: 32px; color: var(--warning-color); font-weight: bold;" id="totalSales">Â¥0</div>
                        <div style="margin-top: 10px; color: #666;">æ€»é”€å”®é¢</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å•†å“ç®¡ç† -->
        <div id="productsTab" style="display: none;">
            <div class="card">
                <div class="card-header">å•†å“åˆ—è¡¨</div>
                <div class="card-body">
                    <table class="table" id="productsTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>å•†å“åç§°</th>
                                <th>ä»·æ ¼</th>
                                <th>åº“å­˜</th>
                                <th>å•†å®¶</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ç”¨æˆ·ç®¡ç† -->
        <div id="usersTab" style="display: none;">
            <div class="card">
                <div class="card-header">ç”¨æˆ·åˆ—è¡¨</div>
                <div class="card-body">
                    <table class="table" id="usersTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>ç”¨æˆ·å</th>
                                <th>é‚®ç®±</th>
                                <th>è§’è‰²</th>
                                <th>çŠ¶æ€</th>
                                <th>æ³¨å†Œæ—¶é—´</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/common.js"></script>
    <script>
        function showTab(tab) {
            document.getElementById('statsTab').style.display = tab === 'stats' ? 'block' : 'none';
            document.getElementById('productsTab').style.display = tab === 'products' ? 'block' : 'none';
            document.getElementById('usersTab').style.display = tab === 'users' ? 'block' : 'none';
            
            if (tab === 'products') {
                loadProducts();
            } else if (tab === 'users') {
                loadUsers();
            }
        }

        async function loadStats() {
            const data = await request('/api/admin/stats');
            if (data.success) {
                document.getElementById('totalUsers').textContent = data.stats.total_users;
                document.getElementById('totalProducts').textContent = data.stats.total_products;
                document.getElementById('totalOrders').textContent = data.stats.total_orders;
                document.getElementById('totalSales').textContent = formatPrice(data.stats.total_sales);
            }
        }

        async function loadProducts() {
            const data = await request('/api/seller/products');
            if (data.success) {
                renderProducts(data.products);
            }
        }

        function renderProducts(products) {
            const tbody = document.querySelector('#productsTable tbody');
            tbody.innerHTML = products.map(p => `
                <tr>
                    <td>${p.id}</td>
                    <td>${p.name}</td>
                    <td>${formatPrice(p.price)}</td>
                    <td>${p.stock}</td>
                    <td>å•†å®¶ID: ${p.seller_id}</td>
                    <td>${getProductStatusBadge(p.status)}</td>
                    <td>
                        ${p.status === 'pending' ? `
                            <button class="btn btn-sm btn-primary" onclick="approveProduct(${p.id})">é€šè¿‡</button>
                            <button class="btn btn-sm btn-outline" onclick="rejectProduct(${p.id})">æ‹’ç»</button>
                        ` : ''}
                    </td>
                </tr>
            `).join('');
        }

        async function approveProduct(productId) {
            const data = await request(`/api/admin/products/approve/${productId}`, { method: 'POST' });
            if (data.success) {
                showToast('å•†å“å·²å®¡æ ¸é€šè¿‡', 'success');
                loadProducts();
            }
        }

        async function rejectProduct(productId) {
            const data = await request(`/api/admin/products/reject/${productId}`, { method: 'POST' });
            if (data.success) {
                showToast('å•†å“å·²æ‹’ç»', 'success');
                loadProducts();
            }
        }

        async function loadUsers() {
            const data = await request('/api/admin/users');
            if (data.success) {
                renderUsers(data.users);
            }
        }

        function renderUsers(users) {
            const tbody = document.querySelector('#usersTable tbody');
            tbody.innerHTML = users.map(u => `
                <tr>
                    <td>${u.id}</td>
                    <td>${u.username}</td>
                    <td>${u.email}</td>
                    <td><span class="badge badge-${u.role === 'admin' ? 'danger' : u.role === 'seller' ? 'warning' : 'secondary'}">${u.role}</span></td>
                    <td><span class="badge badge-${u.status === 'active' ? 'success' : 'secondary'}">${u.status}</span></td>
                    <td>${formatDate(u.created_at)}</td>
                </tr>
            `).join('');
        }

        document.addEventListener('DOMContentLoaded', loadStats);
    </script>
</body>
</html>
